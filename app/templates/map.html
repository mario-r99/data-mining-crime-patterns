<!DOCTYPE html>
<html>
  <head>
    <title>{{ title }}</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='map.css') }}">
  </head>
  <body>
    <div id="map"></div>
    <script
      src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&callback=initMap&libraries=visualization&v=weekly"
      defer
    ></script>
    <script>
      let map, heatmap, police_stations;

      function initMap() {

        // Create the map
        map = new google.maps.Map(document.getElementById("map"), {
          zoom: {{ zoom }},
          center: new google.maps.LatLng({{ center[0] }}, {{ center[1] }}),
          mapTypeId: "roadmap",
        });

        // Create the crime heatmap
        heatmap = new google.maps.visualization.HeatmapLayer({
          data: [{% for point in heatmap %}
              new google.maps.LatLng({{ point[0] }}, {{ point[1] }}),
          {% endfor %}],
          map: map,
          radius: 20,
        });

        // Create the police station markers
        police_stations = [{% for station in police_stations %}
            new google.maps.Marker({
              position: new google.maps.LatLng({{ station[0] }}, {{ station[1] }}),
              map: map,
            }),
        {% endfor %}];
      }

      window.initMap = initMap;
    </script>
  </body>
</html>
